<!--
    This is a demo of AnyStock https://www.anychart.com/products/anystock/ Charts Feature: Drawing Tools / Annotations
    Documentation: https://docs.anychart.com/latest/Stock_Charts/Overview
    API: https://api.anychart.com/latest/anychart.charts.Stock
    Support: https://www.anychart.com/support/
    Contacts: https://www.anychart.com/company/

    https://www.anychart.com/
-->
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <meta name="author" content="https://www.anychart.com">
  <meta name="description"
    content="AnyStock offers a large set of features that allow you to build your online financial portal and one of the most exciting features is the ability to draw/display on the chart so called drawing tools or, as they are called in our documentation documentation and settings, annotations. | Fullscreen version">

  <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
  <title>AnyStock - Drawing Tools and Annotations Demo</title>

  <!-- Normalize css -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/7.0.0/normalize.min.css" />

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/css/bootstrap-select.min.css">

  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">


  <!-- ColorPicker -->
  <link rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.1/css/bootstrap-colorpicker.css" />

  <!-- AnyChart UI -->
  <link rel="stylesheet" href="https://cdn.anychart.com/releases/v8/css/anychart-ui.min.css" />
  <link rel="stylesheet" href="https://cdn.anychart.com/fonts/latest/css/anychart-font.min.css">

  <!--style-->
  <link rel="stylesheet" href="static/css/style.css">

  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>
  <div class='container'>
    <form>
      <div class="row">
        <div class="col">
          <input type="search" name="source" id="autocomplete-1" class="form-control autocomplete" placeholder="Enter Source">
        </div>
        <div class="col">
          <div class="form-group">
            <label for="select-interval">Select Interval:</label>
            <select class="form-control" id="select-interval">
              {% for interval in interval_list %}
              <option>{{interval}}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <button type="submit" class="btn btn-primary mb-2">Submit</button>
      </div>
    </form>
  </div>
  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>
    var data1;
    function xhrSuccess() {
      this.callback.apply(this, this.arguments);
    }

    function xhrError() {
      console.error(this.statusText);
    }

    function loadFile(url, callback /*, opt_arg1, opt_arg2, ... */) {
      var xhr = new XMLHttpRequest();
      xhr.callback = callback;
      xhr.arguments = Array.prototype.slice.call(arguments, 2);
      xhr.onload = xhrSuccess;
      xhr.onerror = xhrError;
      xhr.open("GET", url, true);
      xhr.send(null);
    }
    function showMessage(message) {
      console.log(message + this.responseText);
    }

    function set_data(message) {
      window.data1 = JSON.parse(this.responseText);
      // console.log(window.data1);
      plot_chart();
      add_ema();
      // var chart
    }

  </script>
  <script>
    $( "#autocomplete-1" ).autocomplete({
      source: "/autocomplete",
      minLength: 4,
    });
  </script>
  <div id="loader-wrapper" class="anychart-loader">
    <div class="rotating-cover">
      <div class="rotating-plane">
        <div class="chart-row"><span class="chart-col green"></span><span class="chart-col orange"></span><span
            class="chart-col red"></span></div>
      </div>
    </div>
  </div>

  <table class="table-container">
    <tr>
      <td>
        <div class="toolbar">
          <div class="btn-group">
            <button type="button" class="btn btn-default color-picker" data-color="fill" data-toggle="tooltip"
              title="Сhoose drawing fill color"><span class="color-fill-icon dropdown-color-fill-icon"></span>&nbsp;<b
                class="caret"></b>
            </button>

            <button type="button" class="btn btn-default color-picker" data-color="stroke" data-toggle="tooltip"
              title="Сhoose drawing stroke color"><span class="color-fill-icon dropdown-color-fill-icon"></span>&nbsp;<b
                class="caret"></b>
            </button>

            <select class="selectpicker" id="select-stroke-settings" title="Stroke settings" data-style="btn-lg"
              data-width="121" multiple>
              <optgroup label="Stroke width" data-max-options="1">
                <option data-settings="width" value="0">0 px</option>
                <option data-settings="width" value="1" selected>1 px</option>
                <option data-settings="width" value="2">2 px</option>
                <option data-settings="width" value="3">3 px</option>
                <option data-settings="width" value="4">4 px</option>
                <option data-settings="width" value="5">5 px</option>
              </optgroup>
              <optgroup label="Stroke dash" data-max-options="1">
                <option value="6" data-settings="type" selected>solid</option>
                <option value="7" data-settings="type">dotted</option>
                <option value="8" data-settings="type">dashed</option>
              </optgroup>
            </select>
          </div>
          <div class="btn-group">
            <button type="button" data-action-type="unSelectedAnnotation" class="btn btn-default"
              aria-label="Center Align" data-toggle="tooltip" title="Cursor">
              <i class="ac ac-mouse-pointer" aria-hidden="true"></i>
            </button>
          </div>

          <div class="select-container">
            <select class="selectpicker choose-drawing-tools" title="Drawing tools" data-style="btn-lg" data-width="133"
              data-max-options="1">
              <optgroup label="Lines, Trend lines and Rays:">
                <option data-icon="ac-line" data-annotation-type="line">Line Segment</option>
                <option data-icon="ac-horizontal-line" data-annotation-type="horizontal-line">Horizontal
                  Line
                </option>
                <option data-icon="ac-vertical-line" data-annotation-type="vertical-line">Vertical Line
                </option>
                <option data-icon="ac-infinite-line" data-annotation-type="infinite-line">Infinite Line
                </option>
                <option data-icon="ac-ray" data-annotation-type="ray">Ray</option>
              </optgroup>
              <optgroup label="Geometric shapes:">
                <option data-icon="ac-triangle" data-annotation-type="triangle">Triangle</option>
                <option data-icon="ac-rectangle" data-annotation-type="rectangle">Rectangle</option>
                <option data-icon="ac-ellipse" data-annotation-type="ellipse">Ellipse</option>
              </optgroup>
              <optgroup label="Other tools:">
                <option data-icon="ac-horizontal-range" data-annotation-type="horizontal-range">
                  Horizontal Range
                </option>
                <option data-icon="ac-vertical-range" data-annotation-type="vertical-range">
                  Vertical Range
                </option>
              </optgroup>
              <optgroup label="Other tools:">
                <option data-icon="ac-trend-channel" data-annotation-type="trend-channel">Trend Channel
                </option>
                <option data-icon="ac-finite-trend-channel" data-annotation-type="finite-trend-channel">Trend Channel
                </option>
                <option data-icon="ac-andrews-pitchfork" data-annotation-type="andrews-pitchfork">
                  Andrew's
                  Pitchfork
                </option>
              </optgroup>
              <optgroup label="Fibonacci tools:">
                <option data-icon="ac-fibonacci-fan" data-annotation-type="fibonacci-fan">Fibonacci Fan
                </option>
                <option data-icon="ac-fibonacci-arc" data-annotation-type="fibonacci-arc">Fibonacci Arc
                </option>
                <option data-icon="ac-fibonacci-retracement" data-annotation-type="fibonacci-retracement">Fibonacci
                  Retracement
                </option>
                <option data-icon="ac-fibonacci-timezones" data-annotation-type="fibonacci-timezones">
                  Fibonacci Time
                  Zones
                </option>
              </optgroup>
            </select>
          </div>

          <div class="btn-group hidden-xs">
            <button data-annotation-type="line" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Line Segment">
              <i class="ac ac-line" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="horizontal-line" type="button" class="btn btn-default"
              aria-label="Center Align" data-toggle="tooltip" title="Horizontal Line">
              <i class="ac ac-horizontal-line" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="vertical-line" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Vertical Line">
              <i class="ac ac-vertical-line" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="infinite-line" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Infinite Line">
              <i class="ac ac-infinite-line" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="ray" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Ray">
              <i class="ac ac-ray" aria-hidden="true"></i>
            </button>
          </div>

          <div class="btn-group hidden-xs">
            <button data-annotation-type="triangle" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Triangle">
              <i class="ac ac-triangle" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="rectangle" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Rectangle">
              <i class="ac ac-rectangle" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="ellipse" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Ellipse">
              <i class="ac ac-ellipse" aria-hidden="true"></i>
            </button>
          </div>

          <div class="btn-group hidden-xs">
            <button data-annotation-type="horizontal-range" type="button" class="btn btn-default"
              aria-label="Center Align" data-toggle="tooltip" title="Horizontal Range">
              <i class="ac ac-horizontal-range" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="veertical-range" type="button" class="btn btn-default"
              aria-label="Center Align" data-toggle="tooltip" title="Vertical Range">
              <i class="ac ac-vertical-range" aria-hidden="true"></i>
            </button>
          </div>

          <div class="btn-group hidden-xs">
            <button data-annotation-type="trend-channel" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Trend Channel">
              <i class="ac ac-trend-channel" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="finite-trend-channel" type="button" class="btn btn-default"
              aria-label="Center Align" data-toggle="tooltip" title="Finite Trend Channel">
              <i class="ac ac-finite-trend-channel" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="andrews-pitchfork" type="button" class="btn btn-default"
              aria-label="Center Align" data-toggle="tooltip" title="Andrew's Pitchfork">
              <i class="ac ac-andrews-pitchfork" aria-hidden="true"></i>
            </button>
          </div>

          <div class="btn-group hidden-xs">
            <button data-annotation-type="fibonacci-fan" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Fibonacci Fan">
              <i class="ac ac-fibonacci-fan" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="fibonacci-arc" type="button" class="btn btn-default" aria-label="Center Align"
              data-toggle="tooltip" title="Fibonacci Arc">
              <i class="ac ac-fibonacci-arc" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="fibonacci-retracement" type="button" class="btn btn-default"
              aria-label="Center Align" data-toggle="tooltip" title="Fibonacci Retracement">
              <i class="ac ac-fibonacci-retracement" aria-hidden="true"></i>
            </button>
            <button data-annotation-type="fibonacci-timezones" type="button" class="btn btn-default"
              aria-label="Center Align" data-toggle="tooltip" title="Fibonacci Time Zones">
              <i class="ac ac-fibonacci-timezones" aria-hidden="true"></i>
            </button>

          </div>

          <div class="btn-group-container">
            <div class="btn-group">

              <select class="selectpicker select choose-marker" id="select-marker-type" title="Marker"
                data-style="btn-lg" data-width="90" data-max-options="1">
                <option data-icon="ac-arrow-up-square" data-annotation-type="marker" data-marker-type="arrowUp"
                  data-marker-anchor="center-top">Up Arrow
                </option>
                <option data-icon="ac-arrow-down-square" data-annotation-type="marker" data-marker-type="arrow-down"
                  data-marker-anchor="center-bottom">Down Arrow
                </option>
                <option data-icon="ac-arrow-left-square" data-annotation-type="marker" data-marker-type="arrow-left"
                  data-marker-anchor="left-center">Left Arrow
                </option>
                <option data-icon="ac-arrow-right-square" data-annotation-type="marker" data-marker-type="arrow-right"
                  data-marker-anchor="right-center">Right Arrow
                </option>
                <option data-icon="ac-head-arrow" data-annotation-type="marker" data-marker-type="arrowHead"
                  data-marker-anchor="right-center">Head Arrow
                </option>
                <option data-icon="ac-cross" data-annotation-type="marker" data-marker-type="cross"
                  data-marker-anchor="center">Cross
                </option>
                <option data-icon="ac-diagonal-cros" data-annotation-type="marker" data-marker-type="diagonal-cross"
                  data-marker-anchor="center">Diagonal cross
                </option>
                <option data-icon="ac-diamond" data-annotation-type="marker" data-marker-type="diamond"
                  data-marker-anchor="center">Diamond
                </option>
                <option data-icon="ac-pentagon" data-annotation-type="marker" data-marker-type="pentagon"
                  data-marker-anchor="center">Pentagon
                </option>
                <option data-icon="ac-square" data-annotation-type="marker" data-marker-type="square"
                  data-marker-anchor="center">Square
                </option>
                <option data-icon="ac-star-1" data-annotation-type="marker" data-marker-type="star10"
                  data-marker-anchor="center">Star 1
                </option>
                <option data-icon="ac-star-2" data-annotation-type="marker" data-marker-type="star4"
                  data-marker-anchor="center">Star 2
                </option>
                <option data-icon="ac-star-3" data-annotation-type="marker" data-marker-type="star5"
                  data-marker-anchor="center">Star 3
                </option>
                <option data-icon="ac-star-4" data-annotation-type="marker" data-marker-type="star6"
                  data-marker-anchor="center">Star 4
                </option>
                <option data-icon="ac-star-5" data-annotation-type="marker" data-marker-type="star7"
                  data-marker-anchor="center">Star 5
                </option>
                <option data-icon="ac-trapezium" data-annotation-type="marker" data-marker-type="trapezium"
                  data-marker-anchor="center">Trapezium
                </option>
                <option data-icon="ac-triangle-up" data-annotation-type="marker" data-marker-type="triangle-up"
                  data-marker-anchor="center-top">Triangle Up
                </option>
                <option data-icon="ac-triangle-down" data-annotation-type="marker" data-marker-type="triangle-down"
                  data-marker-anchor="center-bottom">Triangle Down
                </option>
                <option data-icon="ac-triangle-left" data-annotation-type="marker" data-marker-type="triangle-left"
                  data-marker-anchor="left-center">Triangle Left
                </option>
                <option data-icon="ac-triangle-right" data-annotation-type="marker" data-marker-type="triangle-right"
                  data-marker-anchor="right-center">Triangle Right
                </option>
              </select>

              <button type="button" class="btn btn-default volume-btn" data-el-size="marker" data-volume="20"
                data-toggle="popover">Marker size
              </button>

            </div>
          </div>
          <div class="btn-group-container">
            <div class="btn-group">
              <button data-annotation-type="label" type="button" class="btn btn-default" aria-label="Center Align"
                data-toggle="tooltip" title="Label">
                <i class="ac ac-font"></i>
              </button>

              <button type="button" class="btn btn-default" id="annotation-label-autosize" aria-label="Auto-resize"
                data-toggle="tooltip" title="Auto-resize">
                <i class="ac ac-enlarge" aria-hidden="true"></i>
              </button>

              <button type="button" class="btn btn-default color-picker" data-color="fontColor" data-toggle="tooltip"
                title="Сhoose font color"><span class="color-fill-icon dropdown-color-fill-icon"
                  data-color="black"></span>&nbsp;<b class="caret"></b>
              </button>

              <button type="button" class="btn btn-default volume-btn" data-el-size="label" data-volume="15"
                data-toggle="popover">Font size
              </button>

              <select class="selectpicker" id="select-font-style" title="Font settings" data-style="btn-lg"
                data-width="121" multiple>
                <optgroup label="Font style" data-max-options="2">
                  <option data-icon="ac-italic" data-label-method="fontStyle" value="italic">Italic
                  </option>
                  <option data-icon="ac-bold" data-label-method="fontWeight" value="bold">Bold
                  </option>
                </optgroup>
                <optgroup label="Font decoration" data-max-options="1" data-label-method="fontDecoration">
                  <option data-icon="ac-strikethrough" value="line-through">Line-through</option>
                  <option data-icon="ac-overline" value="overline">Overline</option>
                  <option data-icon="ac-underline" value="underline">Underline</option>
                </optgroup>
                <optgroup label="Horizontal align" data-max-options="1" data-label-method="hAlign">
                  <option data-icon="ac-align-center" value="center">Center</option>
                  <option data-icon="ac-align-left" value="left">Left</option>
                  <option data-icon="ac-align-right" value="right">Right</option>
                  <option data-icon="ac-position-left" value="start">Start</option>
                  <option data-icon="ac-position-right" value="end">End</option>
                </optgroup>
                <optgroup label="Anchor" data-max-options="1" data-label-method="anchor">
                  <option data-icon="ac-anc-cb" value="center-bottom">Center bottom</option>
                  <option data-icon="ac-anc-ct" value="center-top">Center top</option>
                  <option data-icon="ac-anc-lb" value="left-bottom">Left bottom</option>
                  <option data-icon="ac-anc-lc" value="left-center">Left center</option>
                  <option data-icon="ac-anc-lt" value="left-top">Left top</option>
                  <option data-icon="ac-anc-rb" value="right-bottom">Right bottom</option>
                  <option data-icon="ac-anc-rc" value="right-center">Right center</option>
                  <option data-icon="ac-anc-rt" value="right-top">Right top</option>
                  <option data-icon="ac-anc-c" value="center">Center</option>
                </optgroup>
                <optgroup label="Vertical align" data-max-options="1" data-label-method="vAlign">
                  <option data-icon="ac-position-top" value="top">Top</option>
                  <option data-icon="ac-position-center2" value="middle">Middle</option>
                  <option data-icon="ac-position-bottom" value="bottom">Bottom</option>
                </optgroup>
              </select>

            </div>
          </div>
          <div class="btn-group-container">
            <div class="btn-group">
              <button data-action-type="removeSelectedAnnotation" type="button" class="btn btn-default"
                aria-label="Center Align" data-toggle="tooltip" title="Delete selected drawing">
                <i class="ac ac-remove-thin" aria-hidden="true"></i>
              </button>
              <button data-action-type="removeAllAnnotations" type="button" class="btn btn-default"
                aria-label="Center Align" data-toggle="tooltip" title="Delete all drawings">Remove All
              </button>
            </div>
          </div>
        </div>
      </td>
    </tr>
    <tr>
      <td class="chart-column">
        <div id="chart-container"></div>
      </td>
    </tr>
  </table>

  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.5.1/js/bootstrap-colorpicker.min.js"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-base.min.js"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-stock.min.js"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-annotations.min.js"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-exports.min.js"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-vml.min.js"></script>
  <script src="https://cdn.anychart.com/releases/v8/js/anychart-ui.min.js"></script>
  <script src="https://cdn.anychart.com/csv-data/msft-daily-short.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-select/1.10.0/js/bootstrap-select.min.js"></script>

  <!-- <script src="static/js/common.js"></script> -->

  <!-- This library enables the automatic resizing of the height and width of
both same and cross domain iFrames to fit their contained content.   -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/3.6.3/iframeResizer.contentWindow.min.js"></script>
  <script>
    var chart;
    var mapping;
    var volumeMapping;
    function plot_chart() {
    initTooltip('bottom');

    
    var $strokeSettings = $('#select-stroke-settings');
    var $colorPickerFill = $('.color-picker[data-color="fill"]');
    var $colorPickerStroke = $('.color-picker[data-color="stroke"]');
    var $annotationLabel;
    // var $markerSize = $('#select-marker-size');
    var $markerSize = $('.volume-btn[data-el-size="marker"]');
    var $fontSize = $('.volume-btn[data-el-size="label"]');
    var $markerSizeBtn = $('.select-marker-size');
    var $fontSettings = $('#select-font-style');

    var $labelMethod = $('[data-label-method]');

    $(function () {
        // page UI elements
        createPageColorPicker();

        // init selectpicker
        $('.selectpicker').selectpicker({
            iconBase: 'ac',
            tickIcon: 'ac-check'
        });

        // init volume bars
        // marker-size, font-size
        initVolumeBar();

        // data from https://cdn.anychart.com/csv-data/msft-daily-short.js
        // var data = get_msft_daily_short_data();
        var data = window.data1;
        // console.log(data)

        // Create new chart object.
        chart = anychart.stock();

        // create data table
        var table = anychart.data.table(0);
        table.addData(data);

        // get timezone offset for the current timezone - 
        // WD_Table_Data_05:19 Tue Jan 12 2021 00:49:56 GMT+0530 (India Standard Time)
        // val = -330
        var timeZoneOffset = new Date().getTimezoneOffset();

        // set timezone offset for correct chart timezone
        anychart.format.outputTimezone(timeZoneOffset);

        var indicator = chart.plot(0).priceIndicator({value: "last-visible"});

        // create data mappings
        mapping = table.mapAs({'open':1,'high':2,'low':3,'close':4,'value': 4});
        volumeMapping = table.mapAs({ 'value': 5, 'type': 'average' });

        // create line series
        plotFirst = chart.plot(0);
        plotFirst.candlestick(mapping)
            .stroke('2 #253992')
            .name(window.stock_name);
        //set zoom on mouse wheel
        chart.interactivity().zoomOnMouseWheel(true);
        
        // annotation = plotFirst.annotations();
        // annotation
        //     .marker()
        //     .xAnchor('2021-01-11 12:00:00')
        //     .valueAnchor(2700)
        //     .stroke('2 #F44336')
        //     .markerType('arrow-down')
        //     .allowEdit(false);


        

        // create scroller series
        chart.scroller().area(mapping)
            .color('#253992 0.3')
            .stroke('#253992');

        // set grid and axis settings
        chart.plot(0).yAxis(0).orientation('right');
        chart.plot(0).yAxis(1)
            .orientation('left')
            .ticks(false)
            .labels(false)
            .minorLabels(false);
        chart.plot()
            .xGrid(true)
            .yGrid(true);

        // set chart padding
        chart.padding()
            .right(35)
            .left(5)
            .top(10);

        // add annotation items in context menu
        chart.contextMenu().itemsFormatter(contextMenuItemsFormatter);

        // use annotation events to update application UI elements
        chart.listen('annotationDrawingFinish', onAnnotationDrawingFinish);
        chart.listen('annotationSelect', onAnnotationSelect);
        chart.listen('annotationUnSelect', function () {
            $colorPickerFill.removeAttr('disabled');
            // $markerSizeBtn.removeAttr('disabled');
            $('.drawing-tools-solo').find('.bootstrap-select').each(function () {
                $(this).removeClass('open');
            })
        });
        chart.listen('chartDraw', function () {
            hidePreloader();

            var $body = $('body');
            var $textArea = '<textarea id="annotation-label"></textarea>';

            if (!$body.find('#annotation-label').length) {
                $body.find('[data-annotation-type="label"]').length ?
                    $body.find('[data-annotation-type="label"]').after($textArea) :
                    $body.append($textArea);
                $annotationLabel = $('#annotation-label');
            }
        });

        // add textarea for label annotation and listen events
        chart.listen('annotationDrawingFinish', function (e) {
            if (e.annotation.type === 'label') {

                $annotationLabel.val(e.annotation.text())
                    .focus()
                    .on('change keyup paste', function (e) {
                        if (e.keyCode === 46) return;

                        try {
                            var annotation = chart.annotations().getSelectedAnnotation();
                            annotation.enabled();
                        } catch (err) {
                            annotation = null;
                        }

                        if (annotation) {
                            $(this).val() ? annotation.text($(this).val()) : annotation.text(' ') && $(this).val(' ');
                        }
                    });

                chart.listen('annotationDrawingFinish', function (e) {
                    if (e.annotation.type === 'label') {
                        $annotationLabel.val(e.annotation.text())
                            .focus();
                    }
                });

                chart.listen('annotationSelect', function (e) {
                    if (e.annotation.type === 'label') {
                        $annotationLabel.val(e.annotation.text())
                            .focus();
                    }
                });

                chart.listen('annotationUnselect', function () {
                    if (e.annotation.type === 'label') {
                        $annotationLabel.val('');
                    }
                });
            }
        });

        // set container id for the chart
        chart.container('chart-container');

        // initiate chart drawing
        chart.draw();
    });

    function initVolumeBar() {
        $('.volume-btn').on('mouseenter', function () {
            var self = this;

            $(this).popover({
                placement: 'bottom',
                html: true,
                trigger: 'manual',
                content: function () {
                    return '<div id="volume-popover">\n' +
                        '     <div class="volume-bar-value text-center">' + $(this).attr('data-volume') + 'px' +
                        '     </div>\n' +
                        '     <input type="range" id="volume-bar" class="volume-bar" step="1" value="' + $(this).attr('data-volume') + '"' +
                        '      min="5" max="35">\n' +
                        '   </div>'
                }
            });

            $(this).popover('show');

            $(this).siblings('.popover').on('mouseleave', function () {
                setTimeout(function () {
                    if (!$('.popover:hover').length) {
                        $(self).popover('hide')
                    }
                }, 100);
            });
        }).on('mouseleave', function () {
            var self = this;

            setTimeout(function () {
                if (!$('.popover:hover').length) {
                    $(self).popover('hide')
                }
            }, 100);
        });
    }

    function createPageColorPicker() {
        var colorPicker = $('.color-picker');
        var strokeWidth;
        var STROKE_WIDTH = 1;
        colorPicker.colorpicker({
            'color': '#e06666',
            'align': 'left'
        });

        colorPicker.on('create', function () {
            var color = $(this).data('color');

            if ($(this).find('.color-fill-icon[data-color]').length) {
                color = $(this).find('.color-fill-icon').attr('data-color');
            }

            $('.color-fill-icon', $(this)).css('background-color', color);
        });

        colorPicker.on('showPicker', function () {
            $(this).parent('div').find('.tooltip.in').tooltip('hide');
        });

        colorPicker.on('changeColor', function () {
            var color = $(this).data('color');
            var annotation = chart.annotations().getSelectedAnnotation();
            var _annotation = annotation;

            if (annotation) {
                if (annotation.type === 'label') {
                    $annotationLabel.focus();
                    annotation = annotation.background();
                }

                switch ($(this).attr('data-color')) {
                    case 'fill' :
                        annotation.fill(color);
                        break;
                    case 'stroke' :
                        strokeWidth = annotation.stroke().thickness || STROKE_WIDTH;
                        strokeDash = annotation.stroke().dash || '';
                        var settings = {
                            thickness: strokeWidth,
                            color: color,
                            dash: strokeDash
                        };

                        setAnnotationStrokeSettings(annotation, settings);
                        break;
                    case 'fontColor':
                        if (_annotation.type === 'label') _annotation.fontColor(color);
                        break;
                }
            }

            if (color === null) {
                $('.color-fill-icon', $(this)).addClass('colorpicker-color');
            } else {
                $('.color-fill-icon', $(this)).removeClass('colorpicker-color')
                    .css('background-color', color);
            }
        });
    }

    function removeSelectedAnnotation() {
        var annotation = chart.annotations().getSelectedAnnotation();
        if (annotation) chart.annotations().removeAnnotation(annotation);

        return !!annotation;
    }

    function removeAllAnnotation() {
        chart.annotations().removeAllAnnotations();
    }

    function onAnnotationDrawingFinish() {
        setToolbarButtonActive(null);
    }

    function onAnnotationSelect(evt) {
        var annotation = evt.annotation;
        var colorFill;
        var colorStroke;
        var strokeWidth;
        var strokeDash;
        var strokeType;
        var markerSize;
        var fontColor;
        var fontSize;

        var $colorPickerFontColor = $('.color-picker[data-color="fontColor"]');

        var fontSettings = [];

        if (annotation.fill || annotation.background) {
            $colorPickerFill.removeAttr('disabled');
            colorFill = annotation.fill ? annotation.fill() : annotation.background().fill();
            colorStroke = annotation.stroke ? annotation.stroke() : annotation.background().stroke();
        } else {
            $colorPickerFill.attr('disabled', 'disabled');
        }

        if (annotation.type === 'label') {
            $annotationLabel.focus();

            fontSize = annotation.fontSize();

            $fontSize.attr('data-volume', fontSize);

            fontColor = annotation.fontColor();

            fontSettings = [];

            $labelMethod.each(function () {
                var method = $(this).data().labelMethod;

                fontSettings.push(annotation[method]());
            });

            // update font settings select
            $fontSettings.val(fontSettings).selectpicker('refresh');

            annotation = annotation.background();
        }

        if (annotation.fill && typeof annotation.fill() === 'function') {
            colorFill = $colorPickerFill.find('.color-fill-icon').css('background-color');
        }

        if (colorStroke !== 'none') {
            colorStroke = annotation.stroke().color;
            strokeWidth = annotation.stroke().thickness;
            strokeDash = annotation.stroke().dash;
        }

        if (annotation.type === 'marker') {
            markerSize = annotation.size();
            $markerSize.attr('data-volume', markerSize);
        } else {
            $markerSizeBtn.attr('disabled', 'disabled');
        }

        if (annotation.fill !== undefined) {
            annotation.fill(colorFill);
        }

        if (fontSize) {
            evt.annotation.fontSize(fontSize);
        }

        switch (strokeDash) {
            case '1 1' :
                strokeType = 7;
                break;
            case '10 5' :
                strokeType = 8;
                break;
            default :
                if (strokeWidth) {
                    strokeType = 6;
                }
                break;
        }

        $colorPickerFill.find('.color-fill-icon').css('background-color', colorFill);
        $colorPickerStroke.find('.color-fill-icon').css('background-color', colorStroke);
        $colorPickerFontColor.find('.color-fill-icon').css('background-color', fontColor);
        $strokeSettings.val([strokeWidth, strokeType]).selectpicker('refresh');
    }

    function contextMenuItemsFormatter(items) {
        // insert context menu item on 0 position
        items['annotations-remove-selected'] = {
            text: "Remove selected annotation",
            action: removeSelectedAnnotation,
            index: -10
        };

        // insert context menu item on 1 position
        items['annotations-remove-all'] = {
            text: "Remove all annotations",
            action: removeAllAnnotation,
            index: -5
        };

        // insert context menu separator
        items['annotations-separator'] = {
            index: -4
        };

        return items;
    }

    function setToolbarButtonActive(type, markerType) {
        var $buttons = $('.btn[data-annotation-type]');
        $buttons.removeClass('active');
        $buttons.blur();

        if (type) {
            var selector = '.btn[data-annotation-type="' + type + '"]';
            if (markerType) selector += '[data-marker-type="' + markerType + '"]';
            $(selector).addClass('active');
        }
    }

    function updatePropertiesBySelectedAnnotation(colorStroke, strokeWidth, strokeType) {
        var annotation = chart.annotations().getSelectedAnnotation();
        if (annotation === null) return;

        if (annotation.type === 'label') {
            $annotationLabel.focus();
            annotation = annotation.background();
        }

        switch (strokeType) {
            case '6' :
                strokeType = null;
                break;
            case '7' :
                strokeType = '1 1';
                break;
            case '8' :
                strokeType = '10 5';
                break;
        }

        var settings = {
            thickness: strokeWidth,
            color: colorStroke,
            dash: strokeType
        };

        setAnnotationStrokeSettings(annotation, settings);
    }

    function setAnnotationStrokeSettings(annotation, settings) {
        annotation.stroke(settings);
        if (annotation.hovered || annotation.selected) {
            annotation.hovered().stroke(settings);
            annotation.selected().stroke(settings);
        }
    }

    function hidePreloader() {
        $('#loader-wrapper').fadeOut('slow');
    }

    function initTooltip(position) {
        $(document).ready(function () {
            $('[data-toggle="tooltip"]').tooltip({
                'placement': position,
                'animation': false
            }).on('show.bs.tooltip', function () {
                if ($(this).hasClass('color-picker') && $('.colorpicker-visible').length) {
                    return false
                }
            })
        });
    }

    function normalizeFontSettings(val) {
        var fontMethods = {};

        $labelMethod.each(function () {
            fontMethods[$(this).data().labelMethod] = null;
        });

        val && val.forEach(function (item) {
            if (item) {
                $fontSettings.find('[data-label-method]').each(function () {
                    var $that = $(this);
                    var $el = $(this).find('option').length ? $(this).find('option') : $(this);

                    $el.each(function () {
                        if ($(this).val() === item) {
                            fontMethods[$that.attr('data-label-method')] = item;
                        }
                    });
                });
            }
        });

        return fontMethods
    }

    $(document).ready(function () {
            $('select.choose-drawing-tools').on('change', changeAnnotations);
            $('select.choose-marker').on('change', changeAnnotations);
            $('[data-annotation-type]').on('click', changeAnnotations);

            $('#annotation-label-autosize').on('click', function () {
                var annotation = chart.annotations().getSelectedAnnotation();

                if (annotation && annotation.type === 'label') {
                    annotation.width(null);
                    annotation.height(null);
                }

                setToolbarButtonActive(null);

                $annotationLabel.focus();
            });

            function changeAnnotations() {
                var $that = $(this);

                setTimeout(function () {
                    var $target = $that;
                    var active = $target.hasClass('active');
                    var markerSize = $markerSize.attr('data-volume');
                    var fontSize = $fontSize.attr('data-volume');
                    var fontColor = $('[data-color="fontColor"]').find('.color-fill-icon').css('background-color');

                    var colorFill = $colorPickerFill.find('.color-fill-icon').css('background-color');
                    var colorStroke = $colorPickerStroke.find('.color-fill-icon').css('background-color');

                    var strokeType;
                    var strokeWidth;
                    var strokeDash;
                    var STROKE_WIDTH = 1;

                    if ($strokeSettings.val()) {
                        switch ($strokeSettings.val()[0]) {
                            case '6' :
                            case '7' :
                            case '8' :
                                strokeType = $strokeSettings.val()[0];
                                strokeWidth = $strokeSettings.val()[1] || STROKE_WIDTH;
                                break;
                            default :
                                strokeWidth = $strokeSettings.val()[0];
                                strokeType = $strokeSettings.val()[1];
                                break;
                        }
                    }

                    switch (strokeType) {
                        case '6' :
                            strokeDash = null;
                            break;
                        case '7' :
                            strokeDash = '1 1';
                            break;
                        case '8' :
                            strokeDash = '10 5';
                            break;
                    }

                    var strokeSettings = {
                        thickness: strokeWidth,
                        color: colorStroke,
                        dash: strokeDash
                    };

                    var fontSettings = normalizeFontSettings($fontSettings.val());

                    if (active) {
                        chart.annotations().cancelDrawing();
                        setToolbarButtonActive(null);
                    } else {
                        var type = $target.data().annotationType || $target.find('option:selected').data().annotationType;

                        if (!$target.data().annotationType) {
                            var markerType = $target.find('option:selected').data().markerType;
                        }

                        setToolbarButtonActive(type, markerType);

                        if (type) {

                            if (!$target.data().annotationType) {
                                var markerAnchor = $target.find('option:selected').data().markerAnchor;
                            }

                            var drawingSettings = {
                                type: type,
                                size: markerSize,
                                markerType: markerType,
                                anchor: markerAnchor,
                                fontSize: fontSize,
                                fontColor: fontColor
                            };

                            $.extend(drawingSettings, fontSettings);

                            if (type === 'label') {
                                drawingSettings.anchor = fontSettings.anchor;

                                drawingSettings.background = {
                                    fill: colorFill,
                                    stroke: strokeSettings
                                };
                                drawingSettings.hovered = {
                                    background: {
                                        stroke: strokeSettings
                                    }
                                };
                                drawingSettings.selected = {
                                    background: {
                                        stroke: strokeSettings
                                    }
                                };
                            } else {
                                drawingSettings.fill = colorFill;
                                drawingSettings.stroke = strokeSettings;
                                drawingSettings.hovered = {
                                    stroke: strokeSettings
                                };
                                drawingSettings.selected = {
                                    stroke: strokeSettings
                                };
                            }

                            chart.annotations().startDrawing(drawingSettings);
                        }
                    }

                    var annotation = chart.annotations().getSelectedAnnotation();

                    if (annotation.fill || annotation.background) {
                        $colorPickerFill.removeAttr('disabled');
                    } else {
                        $colorPickerFill.attr('disabled', 'disabled');
                    }

                    $target.val('');
                }, 1);
            }

            $('.btn[data-action-type]').click(function (evt) {
                var annotation = chart.annotations().getSelectedAnnotation();
                var $target = $(evt.currentTarget);
                $target.blur();
                var type = $target.attr('data-action-type');

                switch (type) {
                    case 'removeAllAnnotations':
                        removeAllAnnotation();
                        break;
                    case 'removeSelectedAnnotation' :
                        removeSelectedAnnotation();
                        break;
                    case 'unSelectedAnnotation' :
                        chart.annotations().unselect(annotation).cancelDrawing();
                        setToolbarButtonActive(null);
                        break;
                }

            });

            $strokeSettings.on('change', function () {
                var strokeWidth;
                var strokeType;
                var STROKE_WIDTH = 1;
                var colorStroke = $colorPickerStroke.find('.color-fill-icon').css('background-color');

                if ($(this).val()) {
                    switch ($(this).val()[0]) {
                        case '6' :
                        case '7' :
                        case '8' :
                            strokeType = $(this).val()[0];
                            strokeWidth = $(this).val()[1] || STROKE_WIDTH;
                            break;
                        default :
                            strokeType = $(this).val()[1];
                            strokeWidth = $(this).val()[0];
                            break;
                    }

                    updatePropertiesBySelectedAnnotation(colorStroke, strokeWidth, strokeType);
                }
            });

            $markerSize.on('change', function () {
                var annotation = chart.annotations().getSelectedAnnotation();

                if (annotation && annotation.type === 'marker') {
                    annotation.size($(this).val());
                }
            });

            $('body').on('change', '.volume-bar', function () {
                var annotation = chart.annotations().getSelectedAnnotation();

                var $popover = $(this).closest('.popover');

                $popover.prev('.volume-btn')
                    .attr('data-volume', $(this).val());

                $popover.find('.volume-bar-value').text($(this).val() + 'px');

                if (annotation && annotation.type === 'label' &&
                    $popover.prev('.volume-btn').attr('data-el-size') === 'label') {
                    annotation.fontSize($(this).val());
                    $annotationLabel.focus();
                } else if (annotation && annotation.type === 'marker' &&
                    $popover.prev('.volume-btn').attr('data-el-size') === 'marker') {
                    annotation.size($(this).val());
                }
            });

            $fontSettings.on('change', function () {
                var annotation = chart.annotations().getSelectedAnnotation();

                if (annotation && annotation.type === 'label') {

                    var fontSettings = normalizeFontSettings($(this).val());

                    $labelMethod.each(function () {
                        var method = $(this).data().labelMethod;

                        annotation[method](fontSettings[method]);
                    });

                    $annotationLabel.focus();
                }
            });

            $('html').keyup(function (e) {
                if (e.keyCode === 46) {
                    removeSelectedAnnotation();
                }
            })
          }
        );
    
    }
    function add_ema(){

      // create ema indicator
      window.chart.plot(0).ema(window.mapping, 50, 'spline')
                .series()
                .stroke('#DB2A0E');
      // var volumePlot = chart.plot(1);
      // volumePlot.height('30%');
      // volumePlot.column(window.volumeMapping).name('Volume');
      // volumePlot
      //   .yAxis(1)
      //   .orientation('right')
      //   .labels();
      
        var secondPlot = window.chart.plot(1);
          secondPlot.height('30%');
          secondPlot.yAxis(1).orientation('right');

          annotation  = secondPlot.annotations();
          // create RSI indicator with period 14
          var rsi = secondPlot.rsi(window.mapping, 14).series();
          rsi.stroke('#64b5f6');

          

    }
    loadFile("/getOHLC", set_data, "Loading Chart Data!\n\n");
  </script>


</body>

</html>
